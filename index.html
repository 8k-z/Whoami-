<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>8k_zi | OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;500;800&family=Rajdhani:wght@500;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.23.0/cytoscape.min.js"></script>
    <style>
        :root {
            --c-accent: #bf00ff;
            --c-accent-sec: #00e5ff;
            --c-accent-dim: rgba(191, 0, 255, 0.1);
            --c-bg: #020202;
            --c-glass: rgba(10, 10, 10, 0.7);
            --c-border: rgba(255, 255, 255, 0.1);
            --font-mono: 'JetBrains Mono', monospace;
            --font-disp: 'Rajdhani', sans-serif;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100dvh;
            background-color: var(--c-bg);
            color: #e0e0e0;
            font-family: var(--font-mono);
            overflow: hidden;
            user-select: none;
        }

        .layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        #grid-layer {
            background-image:
                linear-gradient(rgba(30, 30, 30, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 30, 30, 0.3) 1px, transparent 1px);
            background-size: clamp(20px, 4vw, 40px) clamp(20px, 4vw, 40px);
            opacity: 0.2;
            z-index: 0;
        }

        #particle-canvas {
            z-index: 1;
        }

        #light-mask {
            background: radial-gradient(circle 600px at var(--x) var(--y),
                    transparent 0%,
                    rgba(2, 2, 2, 0.85) 50%,
                    rgba(2, 2, 2, 1) 100%);
            z-index: 2;
        }

        #ui-layer {
            z-index: 10;
            pointer-events: auto;
            position: relative;
            width: 100%;
            height: 100%;
            zoom: 0.9;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: clamp(10px, 2vw, 20px);
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
            gap: 15px;
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        .widget {
            background: var(--c-glass);
            border: 1px solid var(--c-border);
            backdrop-filter: blur(12px);
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .widget:hover {
            border-color: rgba(255, 157, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 157, 0, 0.1);
        }

        .w-header {
            font-family: var(--font-disp);
            font-weight: 700;
            font-size: 0.8rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .id-card {
            width: 300px;
            border-left: 2px solid var(--c-accent);
            flex-shrink: 0;
        }

        .id-main {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .id-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255, 157, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--c-accent);
        }

        .id-info h1 {
            font-family: var(--font-disp);
            font-size: 1.5rem;
            line-height: 1;
            color: #fff;
            font-weight: 700;
        }

        .id-info p {
            font-size: 0.75rem;
            color: var(--c-accent);
        }

        .sys-card {
            width: 250px;
            text-align: right;
            border-right: 2px solid #333;
            flex-shrink: 1;
        }

        .stat-row {
            font-size: 0.75rem;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        .stat-label {
            color: #555;
        }

        .stat-val {
            color: #aaa;
        }

        #stage {
            flex-grow: 1;
            position: relative;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            min-height: 0;
        }

        .window {
            width: 90%;
            max-width: 1000px;
            height: 85%;
            max-height: 800px;
            background: rgba(5, 5, 5, 0.9);
            border: 1px solid var(--c-border);
            border-top: 2px solid var(--c-accent);
            display: none;
            flex-direction: column;
            pointer-events: auto;
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .window.active {
            display: flex;
        }


        .win-head {
            background: rgba(255, 255, 255, 0.03);
            padding: 10px 15px;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--c-border);
            color: #888;
            flex-shrink: 0;
        }

        .res-nav {
            display: flex;
            border-bottom: 1px solid var(--c-border);
            background: rgba(0, 0, 0, 0.3);
            overflow-x: auto;
            scrollbar-width: none;
            flex-shrink: 0;
        }

        .res-nav button {
            background: transparent;
            border: none;
            color: #666;
            padding: 10px 15px;
            font-family: var(--font-disp);
            font-weight: 700;
            font-size: 0.8rem;
            cursor: pointer;
            transition: 0.2s;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
        }

        .res-nav button:hover {
            color: #ccc;
            background: rgba(255, 255, 255, 0.02);
        }

        .res-nav button.active {
            color: var(--c-accent);
            border-bottom-color: var(--c-accent);
        }

        .win-body {
            flex-grow: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0;
            position: relative;
            scrollbar-width: thin;
            scrollbar-color: #333 transparent;
            -webkit-overflow-scrolling: touch;
        }

        .win-body::-webkit-scrollbar {
            width: 6px;
        }

        .win-body::-webkit-scrollbar-track {
            background: transparent;
        }

        .win-body::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        .win-body::-webkit-scrollbar-thumb:hover {
            background: var(--c-accent);
        }

        .dock-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 0;
            pointer-events: auto;
            width: 100%;
            z-index: 20;
            flex-shrink: 0;
        }

        .dock {
            display: flex;
            gap: 10px;
            background: rgba(20, 20, 20, 0.85);
            border: 1px solid var(--c-border);
            padding: 10px;
            border-radius: 12px;
            backdrop-filter: blur(15px);
            max-width: 100%;
            overflow-x: auto;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
        }

        .dock::-webkit-scrollbar {
            display: none;
        }

        .dock-btn {
            background: transparent;
            border: 1px solid transparent;
            color: #888;
            padding: 10px 20px;
            font-family: var(--font-disp);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            position: relative;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .dock-btn:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }

        .dock-btn.active {
            color: var(--c-accent);
            background: var(--c-accent-dim);
            border-color: rgba(255, 157, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 157, 0, 0.1);
        }

        .dock-btn.active::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--c-accent);
            border-radius: 50%;
        }

        #term-output {
            padding: 20px;
            font-size: clamp(0.8rem, 2vw, 1rem);
            color: #ccc;
            height: 100%;
            overflow-y: auto;
        }

        .ln {
            margin-bottom: 4px;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .pr {
            color: var(--c-accent);
            margin-right: 8px;
            display: inline-block;
        }

        .inp {
            background: transparent;
            border: none;
            color: #fff;
            width: 80%;
            outline: none;
            font-family: inherit;
            font-size: inherit;
        }

        /* NANO EDITOR */
        #nano-container {
            display: none;
            flex-direction: column;
            height: 100%;
            background: #000;
            color: #fff;
            font-family: var(--font-mono);
        }

        #nano-header,
        #nano-footer {
            background: #222;
            padding: 5px 10px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
        }

        #nano-body {
            flex-grow: 1;
            padding: 10px;
            overflow: auto;
        }

        #nano-textarea {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: #ddd;
            font-family: inherit;
            font-size: 1rem;
            resize: none;
            outline: none;
        }

        .id-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 20px;
        }

        .social-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--c-border);
            padding: 12px 15px;
            color: #ccc;
            text-decoration: none;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            width: 100%;
            border-radius: 4px;
        }

        .social-link:hover {
            background: var(--c-accent-dim);
            border-color: var(--c-accent);
            transform: translateX(2px);
            cursor: pointer;
        }

        .res-section {
            display: none;
        }

        .res-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .res-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .res-card {
            display: block;
            text-decoration: none;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--c-border);
            padding: 15px;
            transition: 0.2s;
            height: 100%;
            overflow: hidden;
        }

        .res-card:hover {
            background: var(--c-accent-dim);
            border-color: var(--c-accent);
            transform: translateY(-2px);
        }

        .res-card h4 {
            color: #fff;
            font-weight: bold;
            margin-bottom: 2px;
            font-size: 0.95rem;
        }

        .res-card p {
            color: #666;
            font-size: 0.75rem;
            line-height: 1.3;
        }

        .tag {
            color: var(--c-accent);
            font-size: 0.65rem;
            font-weight: bold;
            letter-spacing: 1px;
            display: block;
            margin-bottom: 5px;
        }

        #local-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .data-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px;
        }

        .data-val {
            font-size: 1rem;
            color: #fff;
            word-break: break-all;
        }

        @media (max-width: 1024px) {
            .window {
                width: 95%;
                height: 85%;
            }

            .id-card {
                width: auto;
                flex-grow: 1;
            }
        }

        @media (max-width: 768px) {

            body,
            html {
                overflow-y: auto !important;
                height: auto !important;
                -webkit-overflow-scrolling: touch;
            }

            #ui-layer {
                display: block;
                width: 100%;
                height: auto !important;
                zoom: 1;
                min-height: 100vh;
                padding-bottom: 90px;
            }

            .top-bar {
                margin-bottom: 20px;
            }

            .sys-card {
                display: none;
            }

            .id-card {
                width: 100%;
                border-left: none;
                border-bottom: 1px solid var(--c-accent);
                background: rgba(10, 10, 10, 0.9);
            }

            #stage {
                display: block;
                height: auto !important;
                margin: 0;
            }

            .window {
                width: 100%;
                height: auto !important;
                min-height: 400px;
                border: none;
                border-top: 1px solid var(--c-accent);
                background: rgba(5, 5, 5, 0.95);
                margin-bottom: 20px;
                display: none;
            }

            .window.active {
                display: flex;
            }

            .win-body {
                overflow: visible !important;
                height: auto !important;
                flex-grow: 0;
            }

            .dock-container {
                position: fixed;
                bottom: 0;
                left: 0;
                background: linear-gradient(to top, #020202 85%, transparent);
                padding: 15px 10px 20px 10px;
                z-index: 999;
            }

            .dock {
                width: 100%;
                border-radius: 0;
                border: none;
                background: rgba(20, 20, 20, 0.95);
                justify-content: flex-start;
                padding: 10px;
                box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.5);
            }

            .dock-btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }

            .res-grid {
                grid-template-columns: 1fr;
                gap: 10px;
                padding: 15px;
            }

            .res-card {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 15px;
                min-height: 60px;
            }

            .res-card-content {
                flex: 1;
                min-width: 0;
                text-align: right;
            }

            .res-card h4 {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .res-card .tag {
                margin-bottom: 0;
                flex-shrink: 0;
            }
        }

        @media (max-width: 400px) {
            .id-info h1 {
                font-size: 1.2rem;
            }

            .dock-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes torch-flicker {
            0% {
                opacity: 0.8;
                transform: translateY(0);
            }

            100% {
                opacity: 1;
                transform: translateY(-1px);
            }
        }

        .torch-anim {
            animation: torch-flicker 0.1s infinite alternate;
        }

        /* GRAPH STYLES */
        #cy {
            width: 100%;
            height: 100%;
            background: #111;
            /* matches window bg */
        }

        #id-term {
            width: 100%;
            padding: 10px;
            background: #000;
            border-bottom: 1px solid var(--c-border);
            color: #bf00ff;
            font-family: inherit;
            display: flex;
            align-items: center;
        }

        #id-cmd {
            background: transparent;
            border: none;
            color: #fff;
            outline: none;
            font-family: inherit;
            flex-grow: 1;
            margin-left: 10px;
        }

        /* TOAST INPUT */
        .toast-wrapper {
            position: fixed;
            top: 60px;
            /* Below dock/top-bar */
            left: 50%;
            transform: translateX(-50%) translateY(-150%);
            z-index: 9999;
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.3s;
            pointer-events: none;
            opacity: 0;
        }

        .toast-wrapper.active {
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
            opacity: 1;
        }

        .toast-content {
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid var(--c-accent);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(191, 0, 255, 0.25);
            text-align: center;
            min-width: 320px;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .toast-close {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #666;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: 0.2s;
        }

        .toast-close:hover {
            color: #f55;
        }

        .toast-header {
            color: #ff5722;
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 8px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .toast-msg {
            color: #e0e0e0;
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-family: var(--font-mono);
        }

        .toast-inp {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-bottom: 2px solid var(--c-accent);
            color: #fff;
            padding: 8px;
            width: 100%;
            margin-top: 10px;
            text-align: center;
            font-family: var(--font-mono);
            font-size: 1rem;
            outline: none;
            transition: background 0.2s;
        }

        .toast-inp:focus {
            background: rgba(255, 255, 255, 0.1);
        }

        .res-nav {
            display: flex;
            border-bottom: 2px solid var(--c-accent);
            background: rgba(30, 30, 30, 0.3);
            overflow-x: auto;
            scrollbar-width: none;
            flex-shrink: 0;
            padding: 0 10px;
        }

        .res-nav button {
            background: transparent;
            border: none;
            color: #666;
            padding: 15px 20px;
            font-family: var(--font-disp);
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.2s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .res-nav button:hover {
            color: #ccc;
            background: rgba(255, 255, 255, 0.02);
        }

        .res-nav button.active {
            color: var(--c-accent);
            border-bottom-color: var(--c-accent);
        }

        .tags {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.3);
            color: #888;
            font-weight: bold;
            font-family: var(--font-mono);
        }

        .tag.lang {
            color: var(--c-accent);
            border: 1px solid rgba(255, 157, 0, 0.2);
        }

        .tag.topic {
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.05);
        }

        /* TAGS */
        .tags {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
            flex-wrap: wrap;
        }

        .tag {
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-family: var(--font-mono);
            border: 1px solid transparent;
        }

        /* PURPLE for Language */
        .tag.lang {
            color: #d84bf7;
            background: rgba(189, 0, 255, 0.15);
            border-color: rgba(189, 0, 255, 0.3);
        }

        /* BLUE for Topics */
        .tag.topic {
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.2);
        }
    </style>
</head>

<body>

    <div id="grid-layer" class="layer"></div>
    <canvas id="particle-canvas" class="layer"></canvas>
    <div id="light-mask" class="layer" style="--x: 50%; --y: 50%;"></div>

    <!-- TOAST INPUT UI -->
    <div id="toast-input" class="toast-wrapper">
        <div class="toast-content">
            <div class="toast-close" onclick="closeToast()">âœ•</div>
            <div class="toast-header">Instruction Pointer (RIP) at 0x4005</div>
            <div class="toast-msg">Opcode: je 0x4020 (Jump if ZF=1)</div>
            <div class="toast-msg" style="font-size:0.8rem; color:#888;">Enter RAX value to satisfy 'cmp':</div>
            <input type="text" id="toast-val" class="toast-inp" autocomplete="off" placeholder="0x...">
        </div>
    </div>

    <div id="ui-layer">

        <div class="top-bar">
            <!-- LEFT: ACTIVE SESSION -->
            <div class="widget id-card">
                <div class="w-header">
                    <span>ACTIVE_SESSION</span>
                    <span
                        style="width:8px; height:8px; background:#0f0; border-radius:50%; box-shadow:0 0 5px #0f0;"></span>
                </div>
                <div class="id-main">
                    <div class="id-avatar">
                        <img src="https://github.com/8k-z/Gifs/blob/main/Comp%201.gif?raw=true" alt="Torch"
                            style="width: 100%; height: 100%; object-fit: contain; border-radius: 2px;">
                    </div>
                    <div class="id-info">
                        <h1>8k_zi</h1>
                        <p>JORDANSEC // Reverse & Pwn</p>
                    </div>
                </div>
            </div>

            <!-- RIGHT: LOCAL ENV -->
            <div class="widget sys-card">
                <div class="w-header">LOCAL_ENV</div>
                <div id="sys-data"></div>
            </div>
        </div>

        <div id="stage">

            <div id="win-terminal" class="window active">
                <div class="win-head">
                    <span>TERMINAL</span>
                    <span>bash --login</span>
                </div>
                <div class="win-body" style="display:flex; flex-direction:column;">
                    <div id="term-output">
                        <div class="ln">8k_zi Kernel loaded...</div>
                        <div class="ln">Welcome back, 8k_zi. System integrity verified.</div>
                        <div class="ln">Type <span style="color:var(--c-accent)">help</span> for a list of commands.
                        </div>
                        <div class="ln"><br></div>
                    </div>
                    <!-- NANO UI -->
                    <div id="nano-container">
                        <div id="nano-header">
                            <span style="font-weight:bold;">GNU nano 5.4</span>
                            <span id="nano-filename">New Buffer</span>
                            <span>Modified</span>
                        </div>
                        <div id="nano-body">
                            <textarea id="nano-textarea" spellcheck="false"></textarea>
                        </div>
                        <div id="nano-footer">
                            <span><span style="background:#fff; color:#000;">^S</span> Save</span>
                            <span><span style="background:#fff; color:#000;">^X</span> Exit</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="win-resources" class="window">
                <div class="win-head">
                    <span>RESOURCES</span>
                    <span>/usr/share/resources</span>
                </div>
                <!-- NAV -->
                <div class="res-nav">
                    <button class="active" onclick="filterRes('ALL')">ALL</button>
                    <button onclick="filterRes('AR')">ARABIC</button>
                    <button onclick="filterRes('EN')">ENGLISH</button>
                    <span style="width:1px; background:#333; margin: 10px 15px;"></span>
                    <button onclick="filterRes('topic:RE')">REVERSE</button>
                    <button onclick="filterRes('topic:MAL')">MALWARE</button>
                    <button onclick="filterRes('topic:GAME')">GAME</button>
                    <button onclick="filterRes('topic:SEC')">SEC</button>
                    <button onclick="filterRes('topic:LINUX')">LINUX</button>
                    <button onclick="filterRes('topic:CODE')">DEV</button>
                </div>
                <!-- BODY -->
                <div class="win-body">
                    <div id="resource-grid" class="res-grid"
                        style="display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;">
                        <!-- POPULATED BY JS -->
                    </div>
                </div>
            </div>




            <div id="win-identity" class="window">
                <div class="win-head">
                    <span>IDENTITY</span>
                    <span>~/.disasm</span>
                </div>
                <div class="win-body" style="display:flex; flex-direction:column; overflow:hidden;">
                    <div id="id-term">
                        <span>root@8k_zi:~$</span>
                        <input type="text" id="id-cmd" placeholder="Type 'disas me' to analyze..." autocomplete="off">
                    </div>
                    <div id="cy"></div>
                </div>
            </div>

        </div>

        <!-- Galaxy Window Removed -->

        <div class="dock-container">
            <div class="dock">
                <button class="dock-btn active" onclick="switchTab('terminal')">TERMINAL</button>
                <button class="dock-btn" onclick="switchTab('resources')">RESOURCES</button>
                <button class="dock-btn" onclick="switchTab('identity')">IDENTITY</button>
                <button class="dock-btn" onclick="toggleLight()">LIGHT</button>
            </div>
        </div>

    </div>

    <script>
        const fileSystem = {
            '/': ['bin', 'etc', 'home', 'usr', 'var'],
            '/home': ['8k_zi'],
            '/home/8k_zi': [], // CLEARED FOR USER
            '/bin': ['bash', 'ls', 'cat', 'neofetch', 'ping', 'ip', 'ps', 'date', 'whoami', 'nano'],
            '/etc': ['passwd', 'hostname', 'resolv.conf', 'os-release'],
            '/usr/share/resources': ['(use UI tab to view links)']
        };

        const fileContents = {
            '/etc/passwd': 'root:x:0:0:root:/root:/bin/bash\n8k_zi:x:1000:1000:8k_zi:/home/8k_zi:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin',
            '/etc/hostname': '8k_zi-box',
            '/etc/resolv.conf': 'nameserver 1.1.1.1\nnameserver 8.8.8.8',
            '/etc/os-release': 'NAME="8k_zi OS"\nVERSION="1.0"\nID=8k_zi\nPRETTY_NAME="8k_zi OS v1.0"'
        };

        let currentDir = '/home/8k_zi';
        let commandHistory = [];
        let historyIndex = -1;
        let nanoMode = false;
        let nanoFile = "";
        let lightOn = true;

        // Tab Switching
        // (Duplicate switchTab removed)


        // --- HARDWARE DETECTION ---
        function getBrowser() {
            const ua = navigator.userAgent;
            if (ua.indexOf("OPR") > -1 || ua.indexOf("Opera") > -1) return 'Opera';
            if (ua.indexOf("Edg") > -1) return 'Edge';
            if (ua.indexOf("Chrome") > -1) return 'Chrome';
            if (ua.indexOf("Safari") > -1) return 'Safari';
            if (ua.indexOf("Firefox") > -1) return 'Firefox';
            if (ua.indexOf("MSIE") > -1 || !!document.documentMode) return 'IE';
            return 'Unknown Browser';
        }

        function getOS() {
            const ua = navigator.userAgent;
            if (ua.indexOf("Win") != -1) return "Windows";
            if (ua.indexOf("Mac") != -1) return "MacOS";
            if (ua.indexOf("Linux") != -1) return "Linux";
            if (ua.indexOf("Android") != -1) return "Android";
            if (ua.indexOf("like Mac") != -1) return "iOS";
            return "Web Host";
        }

        function getMemory() {
            // 1. Try standard API (often capped at 8GB for privacy)
            if (navigator.deviceMemory) {
                return navigator.deviceMemory >= 8 ? ">= 8GB" : `${navigator.deviceMemory}GB`;
            }

            // 2. Fallback Heuristic based on CPU Cores
            // High core count usually implies higher RAM
            const cores = navigator.hardwareConcurrency || 4;
            if (cores >= 16) return "32GB (Est)";
            if (cores >= 8) return "16GB (Est)";
            if (cores >= 4) return "8GB (Est)";
            return "4GB (Est)";
        }

        let mx = window.innerWidth / 2, my = window.innerHeight / 2;

        document.addEventListener('mousemove', e => {
            mx = e.clientX; my = e.clientY;
            updateLight();
        });

        document.addEventListener('touchmove', e => {
            if (e.touches.length > 0) {
                mx = e.touches[0].clientX;
                my = e.touches[0].clientY;
                updateLight();
            }
        }, { passive: true });

        function updateLight() {
            if (lightOn) {
                document.getElementById('light-mask').style.background =
                    `radial-gradient(circle 600px at ${mx}px ${my}px, transparent 0%, rgba(2, 2, 2, 0.85) 50%,
                    rgba(2, 2, 2, 1) 100%)`;
            }
        }

        function toggleLight() {
            lightOn = !lightOn;
            document.getElementById('light-mask').style.opacity = lightOn ? '1' : '0';
        }

        function switchTab(id) {
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));
            document.querySelectorAll('.dock-btn').forEach(b => b.classList.remove('active'));

            const btn = Array.from(document.querySelectorAll('.dock-btn')).find(b => {
                const txt = b.innerText.toLowerCase();
                return txt.includes(id) || (id === 'resources' && txt.includes('database'));
            });
            if (btn) btn.classList.add('active');

            // Hide Windows
            document.querySelectorAll('.window').forEach(w => w.classList.remove('active'));

            // Show Target
            const win = document.getElementById(`win-${id}`);
            if (win) win.classList.add('active');

            if (id === 'terminal' && window.innerWidth > 768) {
                setTimeout(() => document.querySelector('.inp')?.focus(), 10);
            }
            if (id === 'identity') {
                setTimeout(() => {
                    if (cy) { cy.resize(); cy.fit(); }
                    document.getElementById('id-cmd').focus();
                }, 50);
            }
        }

        /* DELETED OLD FUNCTIONS (Replaced by new logic at end of file) */

        function updateSys() {
            const el = document.getElementById('sys-data');
            if (!el) return;
            el.innerHTML = `
                <div class="stat-row"><span class="stat-label">OS</span><span class="stat-val">${getOS().toUpperCase()}</span></div>
                <div class="stat-row"><span class="stat-label">CORES</span><span class="stat-val">${navigator.hardwareConcurrency || 4}</span></div>
                <div class="stat-row"><span class="stat-label">RES</span><span class="stat-val">${window.screen.width}x${window.screen.height}</span></div>
                <div class="stat-row"><span class="stat-label">TIME</span><span class="stat-val" style="color:var(--c-accent)">${new Date().toLocaleTimeString()}</span></div>
            `;
        }
        setInterval(updateSys, 1000);
        updateSys();

        const term = document.getElementById('term-output');
        const nanoContainer = document.getElementById('nano-container');
        const nanoArea = document.getElementById('nano-textarea');
        const nanoName = document.getElementById('nano-filename');

        // NANO KEY HANDLER
        nanoArea.addEventListener('keydown', function (e) {
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                // SAVE
                const fullPath = resolvePath(nanoFile);
                fileContents[fullPath] = nanoArea.value;
                // Add to file system if new
                const dir = fullPath.substring(0, fullPath.lastIndexOf('/'));
                const file = fullPath.substring(fullPath.lastIndexOf('/') + 1);

                if (fileSystem[dir] && !fileSystem[dir].includes(file)) {
                    fileSystem[dir].push(file);
                } else if (!fileSystem[dir]) {
                    // Create dir if assumes simple
                    fileSystem[dir] = [file];
                }
                showNotify(`File saved you can ctrl + x to leave`);
            }
            if (e.ctrlKey && e.key === 'x') {
                e.preventDefault();
                // EXIT
                closeNano();
            }
        });

        function openNano(filename) {
            nanoMode = true;
            nanoFile = filename;
            term.style.display = 'none';
            nanoContainer.style.display = 'flex';
            nanoName.innerText = filename;

            const fullPath = resolvePath(filename);
            if (fileContents[fullPath]) {
                nanoArea.value = fileContents[fullPath];
            } else {
                nanoArea.value = '';
            }
            nanoArea.focus();
        }

        function closeNano() {
            nanoMode = false;
            nanoContainer.style.display = 'none';
            term.style.display = 'block';
            termInput();
        }

        function termInput() {
            if (nanoMode) return;
            const d = document.createElement('div');
            d.className = 'ln';
            // Reverted prompt symbol to $
            d.innerHTML = `<span class="pr">8k_zi@sys:${currentDir === '/home/8k_zi' ? '~' : currentDir} $</span><input class="inp" spellcheck="false" autofocus>`;
            term.appendChild(d);
            const i = d.querySelector('input');
            i.focus();

            i.onkeydown = e => {
                if (e.key === 'Enter') {
                    const v = i.value.trim();
                    if (v) {
                        commandHistory.push(v);
                        historyIndex = commandHistory.length;
                    }
                    i.disabled = true;
                    if (v) runCmd(v);
                    termInput();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (historyIndex > 0) {
                        historyIndex--;
                        i.value = commandHistory[historyIndex];
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (historyIndex < commandHistory.length - 1) {
                        historyIndex++;
                        i.value = commandHistory[historyIndex];
                    } else {
                        historyIndex = commandHistory.length;
                        i.value = '';
                    }
                }
            };
            term.scrollTop = term.scrollHeight;
        }

        function resolvePath(path) {
            if (path === '/') return '/';
            if (path === '~') return '/home/8k_zi';
            if (path.startsWith('/')) return path;
            if (path === '..') {
                const parts = currentDir.split('/');
                parts.pop();
                return parts.length === 1 && parts[0] === '' ? '/' : parts.join('/') || '/';
            }
            if (path === '.') return currentDir;
            return (currentDir === '/' ? '' : currentDir) + '/' + path;
        }

        function runCmd(cmd) {
            const parts = cmd.split(' ');
            const c = parts[0].toLowerCase();
            const args = parts.slice(1);

            switch (c) {
                case 'help':
                    log('AVAILABLE COMMANDS:', '#fff');
                    log('  neofetch  System Information');
                    log('  ls        List directory content');
                    log('  cd        Change directory');
                    log('  cat       Print file content');
                    log('  nano      Text Editor');
                    log('  pwd       Print working directory');
                    log('  clear     Clear terminal');
                    log('  whoami    Current user');
                    log('  id        User identity');
                    log('  date      Current time');
                    log('  uptime    System uptime');
                    log('  ip        Network info');
                    log('  ping      Test network connection');
                    log('  ps        Running processes');
                    log('  reboot    Restart system');
                    log('  sudo      Execute as superuser');
                    log('  snake     Play URL Snake Game');
                    log('  disas me  Identity Me (* Use in Identity Terminal)');
                    break;

                case 'neofetch':
                    // PLAIN TEXT DATA
                    const browser = getBrowser();
                    const os = getOS();
                    const mem = getMemory();
                    const cores = navigator.hardwareConcurrency || 4;
                    const res = `${window.screen.width}x${window.screen.height}`;

                    log('--- SYSTEM INFORMATION ---', '#bf00ff');
                    log(`OS:       ${os} (8k_zi OS)`);
                    log(`Browser:  ${browser}`);
                    log(`Kernel:   5.15.0-8k`);
                    log(`Uptime:   ${(performance.now() / 60000).toFixed(0)} mins`);
                    log(`Shell:    bash 5.1`);
                    log(`Screen:   ${res}`);
                    log(`CPU:      ${cores} x Core`);
                    log(`Memory:   ${mem}`);
                    log('--------------------------', '#bf00ff');
                    break;

                case 'ls':
                    const dirToList = args[0] ? resolvePath(args[0]) : currentDir;
                    if (fileSystem[dirToList]) {
                        log(fileSystem[dirToList].join('  '), '#4ade80');
                    } else {
                        log(`ls: cannot access '${args[0]}': No such file or directory`, '#f55');
                    }
                    break;

                case 'snake':
                    toggleSnake();
                    break;

                case 'nano':
                    if (!args[0]) {
                        log('nano: filename argument required');
                    } else {
                        openNano(args[0]);
                        // Stop execution here to prevent new prompt from termInput call
                        throw new Error('nano');
                    }
                    break;

                case 'cd':
                    if (!args[0] || args[0] === '~') {
                        currentDir = '/home/8k_zi';
                    } else {
                        const target = resolvePath(args[0]);
                        if (fileSystem[target]) {
                            currentDir = target;
                        } else {
                            log(`bash: cd: ${args[0]}: No such file or directory`, '#f55');
                        }
                    }
                    break;

                case 'cat':
                    if (!args[0]) {
                        log('cat: missing operand');
                    } else {
                        const targetFile = resolvePath(args[0]);
                        if (fileContents[targetFile]) {
                            log(fileContents[targetFile]);
                        } else {
                            if (fileSystem[targetFile]) {
                                log(`cat: ${args[0]}: Is a directory`, '#f55');
                            } else {
                                log(`cat: ${args[0]}: No such file or directory`, '#f55');
                            }
                        }
                    }
                    break;

                case 'pwd':
                    log(currentDir);
                    break;

                case 'nanox': // Old testing
                    break;


                case 'id':
                    log('uid=1000(8k_zi) gid=1000(8k_zi) groups=1000(8k_zi),4(adm),27(sudo)');
                    break;

                case 'clear':
                    term.innerHTML = '';
                    break;

                case 'resources':
                    switchTab('resources');
                    break;

                case 'date':
                    log(new Date().toString());
                    break;

                case 'uptime':
                    log(` up ${(performance.now() / 60000).toFixed(0)} min,  1 user,  load average: 0.02, 0.04, 0.05`);
                    break;

                case 'ip':
                case 'ifconfig':
                    log('eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500');
                    log('      inet 192.168.1.104  netmask 255.255.255.0  broadcast 192.168.1.255');
                    log('lo:   flags=73<UP,LOOPBACK,RUNNING>  mtu 65536');
                    log('      inet 127.0.0.1  netmask 255.0.0.0');
                    break;

                case 'ping':
                    if (!args[0]) {
                        log('Usage: ping <host>');
                        break;
                    }
                    log(`PING ${args[0]} (127.0.0.1) 56(84) bytes of data.`);
                    setTimeout(() => log(`64 bytes from ${args[0]}: icmp_seq=1 ttl=64 time=0.042 ms`), 200);
                    setTimeout(() => log(`64 bytes from ${args[0]}: icmp_seq=2 ttl=64 time=0.038 ms`), 700);
                    setTimeout(() => log(`64 bytes from ${args[0]}: icmp_seq=3 ttl=64 time=0.041 ms`), 1200);
                    setTimeout(() => log(`--- ${args[0]} ping statistics ---`), 1700);
                    setTimeout(() => log(`3 packets transmitted, 3 received, 0% packet loss`), 1710);
                    break;

                case 'ps':
                    log('  PID TTY          TIME CMD');
                    log(' 1337 pts/0    00:00:00 bash');
                    log(' 1338 pts/0    00:00:00 ps');
                    break;

                case 'reboot':
                    log('Rebooting system...');
                    setTimeout(() => location.reload(), 1000);
                    break;

                case 'sudo':
                    if (!args[0]) {
                        log('usage: sudo <command>');
                    } else {
                        const sudoInput = document.createElement('div');
                        sudoInput.className = 'ln';
                        sudoInput.innerHTML = `[sudo] password for 8k_zi: <input type="password" class="inp" style="width:150px">`;
                        term.appendChild(sudoInput);
                        const pInput = sudoInput.querySelector('input');
                        pInput.focus();
                        pInput.onkeydown = e => {
                            if (e.key === 'Enter') {
                                pInput.disabled = true;
                                log('Sorry, try again.', '#f55');
                                termInput();
                            }
                        };
                        throw new Error('sudo');
                    }
                    break;

                case 'history':
                    commandHistory.forEach((h, i) => log(`  ${i + 1}  ${h}`));
                    break;

                case 'disas':
                    log('Error: "disas" instruction requires the Identity co-processor.', '#f55');
                    log('Hint: Switch to the IDENTITY tab to analyze the bio kernel.', '#666');
                    break;

                default:
                    log(`bash: ${c}: command not found`, '#f55');
            }
        }

        function log(t, color = '#ccc') {
            const d = document.createElement('div');
            d.className = 'ln'; d.style.color = color; d.innerText = t;
            term.appendChild(d);
            term.scrollTop = term.scrollHeight;
        }

        function showNotify(msg) {
            let n = document.getElementById('simple-toast');
            if (!n) {
                n = document.createElement('div');
                n.id = 'simple-toast';
                n.style.cssText = "position:fixed; top:100px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.9); border:1px solid #bf00ff; color:#fff; padding:12px 24px; border-radius:4px; z-index:10000; transition:opacity 0.3s; opacity:0; font-family:'JetBrains Mono', monospace; font-size:0.9rem; pointer-events:none; box-shadow:0 0 20px rgba(191,0,255,0.4); text-align:center;";
                document.body.appendChild(n);
            }
            n.innerText = msg;
            n.style.opacity = '1';
            clearTimeout(n.timeout);
            n.timeout = setTimeout(() => { n.style.opacity = '0'; }, 3000);
        }

        // Wrap initial call in try-catch to allow flow control via throw
        try { termInput(); } catch (e) { }



        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];

        function resize() {
            const dpr = window.devicePixelRatio || 1;
            canvas.width = window.innerWidth * dpr;
            canvas.height = window.innerHeight * dpr;
            canvas.style.width = `${window.innerWidth}px`;
            canvas.style.height = `${window.innerHeight}px`;
            ctx.scale(dpr, dpr);
            width = window.innerWidth;
            height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        for (let i = 0; i < 300; i++) {
            particles.push({
                x: Math.random() * width,
                y: Math.random() * height,
                vx: (Math.random() - 0.5) * 1,
                vy: (Math.random() - 0.5) * 1,
                s: 1 + Math.random() * 2
            });
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);

            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];

                p.x += p.vx;
                p.y += p.vy;

                if (p.x < 0 || p.x > width) p.vx *= -1;
                if (p.y < 0 || p.y > height) p.vy *= -1;

                const dx_m = p.x - mx;
                const dy_m = p.y - my;
                const dist_m = Math.sqrt(dx_m * dx_m + dy_m * dy_m);

                for (let j = i + 1; j < particles.length; j++) {
                    let p2 = particles[j];
                    let dx = p.x - p2.x;
                    let dy = p.y - p2.y;
                    let dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < 100) {
                        ctx.beginPath();
                        ctx.strokeStyle = i % 2 === 0 ? '#bf00ff' : '#00e5ff';

                        let alpha = (1 - dist / 100) * 0.5;

                        if (dist_m < 350) {
                            alpha += (1 - dist_m / 350) * 0.8;
                        } else {
                            alpha *= 0.15;
                        }

                        if (alpha > 1) alpha = 1;
                        if (alpha < 0) alpha = 0;

                        if (alpha > 0.01) {
                            ctx.globalAlpha = alpha;
                            ctx.lineWidth = 1;
                            ctx.moveTo(p.x, p.y);
                            ctx.lineTo(p2.x, p2.y);
                            ctx.stroke();
                        }
                    }
                }

                ctx.fillStyle = i % 2 === 0 ? '#bf00ff' : '#00e5ff';
                let pAlpha = 0.2;
                if (dist_m < 350) pAlpha += (1 - dist_m / 350);
                if (pAlpha > 1) pAlpha = 1;

                ctx.globalAlpha = pAlpha;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.s, 0, Math.PI * 2);
                ctx.fill();
            }
            requestAnimationFrame(animate);
        }
        animate();

        // --- CYTOSCAPE GRAPH ---
        let cy;

        function initGraph() {
            cy = cytoscape({
                container: document.getElementById('cy'),
                style: [
                    {
                        selector: 'node',
                        style: {
                            'shape': 'round-rectangle',
                            'background-color': '#1a1a1a',
                            'border-width': 1,
                            'border-color': '#bf00ff', // accent
                            'label': 'data(label)',
                            'color': '#00e5ff', // accent-sec
                            'text-valign': 'center',
                            'text-halign': 'center',
                            'text-wrap': 'wrap',
                            'width': '300px',
                            'height': '160px',
                            'font-family': 'monospace',
                            'font-size': '11px',
                            'text-justification': 'left',
                            'content': 'data(label)'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 2,
                            'line-color': '#444',
                            'target-arrow-color': '#444',
                            'target-arrow-shape': 'triangle',
                            'curve-style': 'bezier'
                        }
                    },
                    {
                        selector: '.unlocked',
                        style: {
                            'background-color': '#111',
                            'border-color': '#bf00ff',
                            'color': '#fff'
                        }
                    }
                ],
                layout: { name: 'grid' },
                userZoomingEnabled: true,
                userPanningEnabled: true,
                boxSelectionEnabled: false,
                wheelSensitivity: 0.2
            });

            // --- DATA BLOCKS ---
            const startBlock = {
                group: 'nodes',
                data: {
                    id: 'main',
                    label: '0x4000 _start:\npush rbp\nmov rbp, rsp\nsub rsp, 0x20'
                },
                position: { x: 400, y: 50 }
            };

            const bioBlock = {
                group: 'nodes',
                data: {
                    id: 'bio',
                    label: '0x4020 _bio:\n; JordanSec CTF | Reverse & Pwn\nmov rax, 0x8\ncmp rax, rbx\njz 0x6000 ; discord main\njnz 0x6020 ; discord alt'
                },
                position: { x: 200, y: 250 }
            };

            const devBlock = {
                group: 'nodes',
                data: {
                    id: 'dev',
                    label: '0x4050 _dev:\n; C/C++/Python | Bot Dev\ntest rcx, rcx\njz 0x7000 ; telegram\njnz 0x7020 ; github'
                },
                position: { x: 600, y: 250 }
            };

            // Social Nodes (Bio Branch)
            const dc1Block = { group: 'nodes', data: { id: 'dc1', label: '0x6000 (Main)\n8k_z' }, position: { x: 100, y: 450 } };
            const dc2Block = { group: 'nodes', data: { id: 'dc2', label: '0x6020 (Alt)\n8k_zi' }, position: { x: 300, y: 450 } };

            // Social Nodes (Dev Branch)
            const tgBlock = { group: 'nodes', data: { id: 'telegram', label: '0x7000 (Telegram)\n@itz_8k_z' }, position: { x: 500, y: 450 } };
            const ghBlock = { group: 'nodes', data: { id: 'github', label: '0x7020 (GitHub)\n8k-z' }, position: { x: 700, y: 450 } };

            // Input Listener
            const cmd = document.getElementById('id-cmd');
            cmd.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const val = this.value.trim();
                    if (val === 'disas me' || val === 'disas main') {
                        cy.add(startBlock);
                        cy.fit({ padding: 50 });
                        this.value = '';
                        this.disabled = true;
                        this.placeholder = "Analysis in progress...";
                    }
                }
            });

            // Tap Logic
            cy.on('tap', 'node', function (evt) {
                var node = evt.target;

                if (node.id() === 'main') {
                    if (cy.getElementById('bio').length > 0) return;

                    // MAIN CHALLENGE: STACK ALLOCATION
                    showToast(
                        "", // Removed Instruction Text
                        "Enter the size of the stack frame allocated (hex):",
                        (val) => {
                            if (val === '0x20') {
                                cy.add([
                                    bioBlock, devBlock,
                                    { group: 'edges', data: { source: 'main', target: 'bio' } },
                                    { group: 'edges', data: { source: 'main', target: 'dev' } }
                                ]);
                                cy.data('layout', 'preset');
                                cy.fit({ padding: 50 });
                                cy.edges().animate({ style: { 'line-color': '#bf00ff', 'target-arrow-color': '#bf00ff' } }, { duration: 500 });
                                return true; // Success
                            } else {
                                return "Segmentation Fault: Incorrect Stack Size."; // Error
                            }
                        }
                    );
                }

                if (node.id() === 'bio') {
                    // BIO CHALLENGE: RBX VALUE for JZ/JNZ
                    showToast(
                        "", // Removed Instruction Text
                        "Enter value for RBX to trigger Jump:",
                        (val) => {
                            if (val === '0x8') {
                                // JZ -> DC MAIN (0x6000)
                                if (cy.getElementById('dc1').length === 0) {
                                    cy.add([
                                        { group: 'nodes', data: { id: 'dc1', label: '0x6000 dc_main proc\nlea rdi, [url]\ncall open\ndc_main endp' }, position: { x: 100, y: 450 } },
                                        { group: 'edges', data: { source: 'bio', target: 'dc1' } }
                                    ]);
                                    cy.fit({ padding: 20 });
                                }
                            } else {
                                // JNZ -> DC ALT (0x6020)
                                if (cy.getElementById('dc2').length === 0) {
                                    cy.add([
                                        { group: 'nodes', data: { id: 'dc2', label: '0x6020 dc_alt proc\nlea rdi, [url]\ncall open\ndc_alt endp' }, position: { x: 300, y: 450 } },
                                        { group: 'edges', data: { source: 'bio', target: 'dc2' } }
                                    ]);
                                    cy.fit({ padding: 20 });
                                }
                            }
                            return true; // Always valid, just different branches
                        }
                    );
                }

                if (node.id() === 'dev') {
                    // DEV CHALLENGE: JUMP ADDRESS
                    showToast(
                        "", // Removed Instruction Text
                        "Enter Address to Jump to:",
                        (val) => {
                            if (val === '0x7000') {
                                if (cy.getElementById('telegram').length === 0) {
                                    cy.add([
                                        { group: 'nodes', data: { id: 'telegram', label: '0x7000 telegram proc\nlea rdi, [url]\ncall open\ntelegram endp' }, position: { x: 500, y: 450 } },
                                        { group: 'edges', data: { source: 'dev', target: 'telegram' } }
                                    ]);
                                    cy.fit({ padding: 20 });
                                }
                                return true;
                            } else if (val === '0x7020') {
                                if (cy.getElementById('github').length === 0) {
                                    cy.add([
                                        { group: 'nodes', data: { id: 'github', label: '0x7020 github proc\nlea rdi, [url]\ncall open\ngithub endp' }, position: { x: 700, y: 450 } },
                                        { group: 'edges', data: { source: 'dev', target: 'github' } }
                                    ]);
                                    cy.fit({ padding: 20 });
                                }
                                return true;
                            } else {
                                return "Invalid Address: Segfault.";
                            }
                        }
                    );
                }

                // LINKS
                if (node.id() === 'github') window.open('https://github.com/8k-z', '_blank');
                if (node.id() === 'telegram') window.open('https://t.me/itz_8k_z', '_blank');
                if (node.id() === 'dc1') window.open('https://discordapp.com/users/741684920274911322', '_blank'); // 8k_z
                if (node.id() === 'dc2') window.open('https://discordapp.com/users/1268086394694275186', '_blank'); // 8k_zi
            });

            // Helper to Close Toast
            window.closeToast = function () {
                const toast = document.getElementById('toast-input');
                const inp = document.getElementById('toast-val');
                toast.classList.remove('active');
                if (inp) inp.onkeydown = null;
            };

            // Helper for Toast with Validation
            function showToast(header, msg, onValidate) {
                const toast = document.getElementById('toast-input');
                const head = toast.querySelector('.toast-header');
                const bodyMsg = toast.querySelectorAll('.toast-msg');
                const inp = document.getElementById('toast-val');

                // Reset UI
                head.innerText = header;
                bodyMsg[0].innerText = "";
                bodyMsg[1].innerText = msg;
                inp.style.borderBottom = '2px solid var(--c-accent)';

                // Remove old error if exists
                const oldErr = toast.querySelector('.toast-err');
                if (oldErr) oldErr.remove();

                toast.classList.add('active');
                inp.value = '';
                inp.focus();

                inp.onkeydown = (e) => {
                    if (e.key === 'Enter') {
                        const val = inp.value.trim();
                        // Validate
                        const result = onValidate(val);

                        if (result === true) {
                            // Success
                            toast.classList.remove('active');
                            inp.onkeydown = null;
                        } else {
                            // Error
                            let errEl = toast.querySelector('.toast-err');
                            if (!errEl) {
                                errEl = document.createElement('div');
                                errEl.className = 'toast-err toast-msg';
                                errEl.style.color = '#f55';
                                errEl.style.marginTop = '8px';
                                errEl.style.fontWeight = 'bold';
                                toast.querySelector('.toast-content').appendChild(errEl);
                            }
                            errEl.innerText = result || "Error";
                            inp.style.borderBottom = '2px solid #f55';
                            // Reset animation
                            inp.style.animation = 'none';
                            inp.offsetHeight; /* trigger reflow */
                            inp.style.animation = 'shake 0.3s';
                        }
                    }
                    if (e.key === 'Escape') {
                        toast.classList.remove('active');
                        inp.onkeydown = null;
                    }
                };
            }
        }

        // --- RESOURCES DATA (Re-injected) ---
        const resources = [
            { t: "rETKit", l: "AR", tops: ["RE", "MAL", "ADV"], d: "Comprehensive, Assembly, Malware, Hooking.", u: "https://www.youtube.com/@retkitt/videos" },
            { t: "NullByte", l: "AR", tops: ["RE", "LINUX"], d: "Practical intro: GDB, Ghidra, Keygens, Overflows.", u: "https://www.youtube.com/@nullbyte0x" },
            { t: "Arabic Crackmes", l: "AR", tops: ["RE", "CRACK"], d: "Solving simple programs to practice reversing.", u: "https://crackmes.one/" },
            { t: "OpenSecurityTraining", l: "EN", tops: ["RE", "MAL", "ADV"], d: "Combined: Intro to RE (x86) & Advanced Malware.", u: "https://opensecuritytraining.info/" },
            { t: "Malware Unicorn", l: "EN", tops: ["RE", "MAL", "ADV"], d: "Combined: RE101 (Basics) & RE102 (Anti-RE).", u: "https://malwareunicorn.org/" },
            { t: "Guided Hacking", l: "EN", tops: ["GAME", "RE"], d: "Game Hacking bible: Cheat Engine, C++, Hooks.", u: "https://www.youtube.com/@guidedhacking" },
            { t: "LiveOverflow", l: "EN", tops: ["CTF", "RE", "LINUX"], d: "Entertaining, visual explanations of CTF & binary exploits.", u: "https://www.youtube.com/c/LiveOverflow" },
            { t: "OALabs", l: "EN", tops: ["MAL", "INT"], d: "Real-world malware analysis with Ghidra/x64dbg.", u: "https://www.youtube.com/c/OALabs" },
            { t: "MalwareAnalysisForHedgehogs", l: "EN", tops: ["MAL", "ADV"], d: "Deep dives into virus analysis & techniques.", u: "https://www.youtube.com/c/MalwareAnalysisForHedgehogs" },
            { t: "HEXORCIST", l: "EN", tops: ["RE", "TOOLS"], d: "IDA & x64dbg tips and tricks.", u: "https://www.youtube.com/@HEXORCIST" },
            { t: "Udemy Courses", l: "EN", tops: ["RE", "MAL", "TOOLS"], d: "Combined: IDA Basics & REMAC+.", u: "https://www.udemy.com/" },
            { t: "Tuts4You", l: "EN", tops: ["RE", "CRACK", "IDA"], d: "Combined: Lena151 (OllyDbg) & TiGa (IDA).", u: "https://forum.tuts4you.com/" },

            // --- PDF BOOKS ---
            { t: "C++ Crash Course", l: "EN", tops: ["CODE", "C++"], d: "A fast-paced introduction to the core language and libraries.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/C++.pdf" },
            { t: "Code with JavaScript", l: "EN", tops: ["CODE", "JS"], d: "Best practices for writing effective JavaScript code.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Code_with_JavaScript.pdf" },
            { t: "Info Security Principles", l: "EN", tops: ["SEC", "NET"], d: "General theory on network security and threats.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Information.Security.Book.pdf" },
            { t: "How Linux Works", l: "EN", tops: ["LINUX", "OS"], d: "What every superuser should know about Linux internals.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/How_Linux_Works.pdf" },
            { t: "Learn to Code (Python)", l: "EN", tops: ["CODE", "PY"], d: "A Python programming primer by solving problems.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Learn.to.Code.by.Solving.Problems.pdf" },
            { t: "Malware Data Science", l: "EN", tops: ["MAL", "DS"], d: "Attack Detection and Attribution using Python.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Malware.pdf" },
            { t: "Modern x86 Assembly", l: "EN", tops: ["ASM", "RE"], d: "Focuses on 32-bit, 64-bit, SSE, and AVX assembly.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Modern_X86_Assembly_Language_Programming.pdf" },
            { t: "OS Theory (Arabic)", l: "AR", tops: ["OS", "CS"], d: "Comprehensive look at Operating Systems theory.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Operating-Systems-In-Arabic.pdf" },
            { t: "Practical Linux Forensics", l: "EN", tops: ["FOR", "LINUX"], d: "Forensic analysis specifically for Linux systems.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Practical-Linux-Forensics-A-Guide-for-Digital-Investigators.pdf" },
            { t: "Effective C", l: "EN", tops: ["CODE", "C"], d: "An introduction to professional, secure C programming.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Professional.C.Programming.pdf" },
            { t: "Python Ethical Hacking", l: "EN", tops: ["SEC", "PY"], d: "Developing deployment and avoiding malware.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/Python.Ethical.Hacking.from.Scratch.pdf" },
            { t: "RTFM v2", l: "EN", tops: ["RED", "REF"], d: "Red Team Field Manual: Offensive security references.", u: "https://github.com/8k-z/Learnresources/releases/download/v0.0.1/RTFM.Red.Team.Field.Manual.v2.Ben.Cl.Z-Library.pdf" }
        ];

        function initResources() {
            renderResources(resources);
        }

        function renderResources(list) {
            const grid = document.getElementById('resource-grid');
            if (!grid) return;

            // Render with Tags Row (Purple/Blue)
            grid.innerHTML = list.map(r => `
                <a href="${r.u}" target="_blank" class="res-card">
                    <div class="res-card-content">
                        <div class="tags">
                            <span class="tag lang">${r.l === 'AR' ? 'AR' : 'EN'}</span>
                            ${r.tops.map(t => `<span class="tag topic">${t}</span>`).join('')}
                        </div>
                        <h4>${r.t}</h4>
                        <p>${r.d}</p>
                    </div>
                </a>
            `).join('');

            grid.style.display = 'grid';
            grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(280px, 1fr));';
            grid.style.gap = '15px';
        }

        function filterRes(filter) {
            // Update active button
            document.querySelectorAll('.res-nav button').forEach(b => {
                const attr = b.getAttribute('onclick');
                if (attr && attr.includes(`'${filter}'`)) {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });

            if (filter === 'ALL') {
                renderResources(resources);
            } else if (filter.startsWith('topic:')) {
                const topic = filter.split(':')[1];
                renderResources(resources.filter(r => r.tops.includes(topic)));
            } else {
                renderResources(resources.filter(r => r.l === filter));
            }
        }

        // Init Resources (Delayed slightly to ensure DOM)
        setTimeout(() => {
            initResources();
            startSnake(); // Auto-start URL Snake
        }, 500);

        // Initialize immediately but it relies on container visibility
        // switchTab handles the fit/resize
        document.addEventListener('DOMContentLoaded', initGraph);

        // --- URL SNAKE GAME ---
        const SNAKE_W = 20;
        const SNAKE_H = 4;
        const SNAKE_SPEED = 200;
        let s_snake = [];
        let s_food = { x: 0, y: 0 };
        let s_dir = { x: 1, y: 0 };
        let s_nextDir = { x: 1, y: 0 };
        let s_score = 0;
        let s_interval = null;
        let s_running = false;

        const S_SLASH = 'âŸ‹';
        const S_BASE = 0x2800;
        const S_DOTS = [1, 2, 4, 64];

        function toggleSnake() {
            if (s_running) {
                stopSnake();
                log('Snake Game Stopped.', '#ff5555');
            } else {
                startSnake();
                log('Snake Game Started! Look at your URL bar.', '#00ff88');
                log('Use Arrow Keys to move.', '#00ff88');
            }
        }

        function initSnake() {
            s_snake = [{ x: 5, y: 2 }, { x: 4, y: 2 }, { x: 3, y: 2 }];
            s_dir = { x: 1, y: 0 };
            s_nextDir = { x: 1, y: 0 };
            s_score = 0;
            spawnSnakeFood();
        }

        function spawnSnakeFood() {
            let valid = false;
            while (!valid) {
                s_food.x = Math.floor(Math.random() * SNAKE_W);
                s_food.y = Math.floor(Math.random() * SNAKE_H);
                valid = !s_snake.some(s => s.x === s_food.x && s.y === s_food.y);
            }
        }

        function renderSnake() {
            let display = '';
            for (let x = 0; x < SNAKE_W; x++) {
                let dot = 0;
                for (const seg of s_snake) {
                    if (seg.x === x && seg.y >= 0 && seg.y < SNAKE_H) dot |= S_DOTS[seg.y];
                }
                if (s_food.x === x) dot |= S_DOTS[s_food.y];
                display += dot > 0 ? String.fromCharCode(S_BASE + dot) : S_SLASH;
            }
            return `|${display}|[${s_score}]`;
        }

        function updateSnakeURL(frame) {
            try { history.replaceState(null, '', '#' + frame); }
            catch (e) { location.hash = frame; }
        }

        function snakeLoop() {
            s_dir = { ...s_nextDir };
            const head = s_snake[0];
            const newHead = { x: head.x + s_dir.x, y: head.y + s_dir.y };

            if (newHead.x < 0 || newHead.x >= SNAKE_W || newHead.y < 0 || newHead.y >= SNAKE_H) {
                snakeOver('Wall'); return;
            }
            if (s_snake.some(s => s.x === newHead.x && s.y === newHead.y)) {
                snakeOver('Self'); return;
            }

            s_snake.unshift(newHead);
            if (newHead.x === s_food.x && newHead.y === s_food.y) {
                s_score += 10;
                spawnSnakeFood();
            } else {
                s_snake.pop();
            }
            updateSnakeURL(renderSnake());
        }

        function snakeOver(reason) {
            stopSnake();
            updateSnakeURL(`|XX_GAME_OVER_XX|[${s_score}]`);
            // Auto-restart after 2 seconds
            setTimeout(startSnake, 2000);
        }

        function startSnake() {
            if (s_running) return;
            initSnake();
            s_running = true;
            s_interval = setInterval(snakeLoop, SNAKE_SPEED);
            updateSnakeURL(renderSnake());
        }

        function stopSnake() {
            if (s_interval) clearInterval(s_interval);
            s_interval = null;
            s_running = false;
            updateSnakeURL(renderSnake() + '[paused]');
        }

        // Global Key Listener for Snake
        document.addEventListener('keydown', (e) => {
            if (!s_running) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                switch (e.key) {
                    case 'ArrowUp': if (s_dir.y !== 1) s_nextDir = { x: 0, y: -1 }; break;
                    case 'ArrowDown': if (s_dir.y !== -1) s_nextDir = { x: 0, y: 1 }; break;
                    case 'ArrowLeft': if (s_dir.x !== 1) s_nextDir = { x: -1, y: 0 }; break;
                    case 'ArrowRight': if (s_dir.x !== -1) s_nextDir = { x: 1, y: 0 }; break;
                }
            }
        });

        // Auto-pause when window loses focus (e.g. clicking URL bar)
        window.addEventListener('blur', () => {
            if (s_running) {
                stopSnake();
                // log removed
            }
        });

        // Global Key Listener for Snake
        document.addEventListener('keydown', (e) => {
            if (!s_running) return;
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                switch (e.key) {
                    case 'ArrowUp': if (s_dir.y !== 1) s_nextDir = { x: 0, y: -1 }; break;
                    case 'ArrowDown': if (s_dir.y !== -1) s_nextDir = { x: 0, y: 1 }; break;
                    case 'ArrowLeft': if (s_dir.x !== 1) s_nextDir = { x: -1, y: 0 }; break;
                    case 'ArrowRight': if (s_dir.x !== -1) s_nextDir = { x: 1, y: 0 }; break;
                }
            }
        });

    </script>
</body>

</html>a
